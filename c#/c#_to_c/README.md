# What is this?

This is a simple demonstration of how to call native code using .Net (C#) that should be fairly cross platform. It's been tested on both Linux and Windows.

# Getting this to work

This is intended for students in the RIT Software Performance Engineering course. But who knows? It might work for other people too.

This sample was designed to work as-is under Linux, but should work anywhere both `gcc` and `dotnet` commands are avalible. On Windows, you can use the Visual Studio .SLN file.

If you're not using .Net Core (`dotnet` command) or Visual Studio (for example, monodevelop), you will probably need to set up your own project file for the C# code.

## Linux/Mac/Etc

(Make sure you have both gcc and [dotnet 2.0](https://www.microsoft.com/net/download/core) installed)

1. Clone this repo somewhere
2. `cd` into `c#/c#_to_c/libnative`
3. Run `make` to build the native (C) library
4. `cd ../dotnet && dotnet restore` to initialize the C# app
5. `dotnet run` to run the C#
6. Verify the output
7. Now step through the code to figure out how all this worked

## Windows

(Make sure you have Visual Studio 2017 installed)

1. Clone this repo somewhere
2. Open `dotnet.sln` with Visual Studio
3. Build the solution (if you get "cannot open ucrt.lib" messages, you need to [change the sdk for the native project](https://msdn.microsoft.com/en-us/library/mt186161.aspx))
4. Press the Run button
5. Verify the output
6. Now step through the code to figure out how all this worked

# Notes

Here are some explanations of what's there

* `native.c` is where the C functions are defined.
* `Makefile` was generated by me (Scott) to work under Linux. It compiles `native.c` to a shared library (`.so`) file (Linux equivalent of `.dll`). Note that this file isn't used on Windows as Visual Studio handles all this for us.
* `Program.cs` is the (interpreted) C# source that loads the native library and calls into it.

**Note:** The library must be placed next to the compiled C# binary. The `.csproj` file is set up to do that for you, but if you make your own project, you'll need to set that up.

**Note2:** On Windows, the native library must be a `dll`. Pretty much everwhere else, it must be a `so`. If you leave off the filename when importing the library in C# (as I have done), C# will choose the appropriate extension for you.

**Note3:** I included extra complexity here to support both Linux and Windows. You don't need to do this if you're working on a single platform.

**Note4:** You can use other versions of Visual Studio but you may need to edit the project files to downgrade them.


# Resources
These are helpful sites to guide you through what's happening here

* [.Net docs on calling native code](https://docs.microsoft.com/en-us/dotnet/standard/native-interop)
* [This StackOverflow](https://stackoverflow.com/questions/11425202/is-it-possible-to-call-a-c-function-from-c-net)
